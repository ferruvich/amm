<?php

class ViewDescriptor {
    const get = 'get';
    const post = 'post';
    private $titolo;
    private $logo_file;
    private $menu_file;
    private $leftBar_file;
    private $rightBar_file;
    private $content_file;
    private $messaggioErrore;
    private $messaggioConferma;
    private $pagina;
    private $sottoPagina;
    private $impToken;
    private $js;
    private $json;
    
    public function __construct() {
        $this->js = array();
        $this->json = false;
    }

    public function getTitolo() {
        return $this->titolo;
    }

    public function setTitolo($titolo) {
        $this->titolo = $titolo;
    }

    public function setLogoFile($logoFile) {
        $this->logo_file = $logoFile;
    }

    public function getLogoFile() {
        return $this->logo_file;
    }

    public function getMenuFile() {
        return $this->menu_file;
    }

    public function setMenuFile($menuFile) {
        $this->menu_file = $menuFile;
    }

    public function getLeftBarFile() {
        return $this->leftBar_file;
    }

    public function setLeftBarFile($leftBar) {
        $this->leftBar_file = $leftBar;
    }

    public function getRightBarFile() {
        return $this->rightBar_file;
    }
    
    public function setRightBarFile($rightBar) {
        $this->rightBar_file = $rightBar;
    }

    public function setContentFile($contentFile) {
        $this->content_file = $contentFile;
    }

    public function getContentFile() {
        return $this->content_file;
    }
    
    public function getMessaggioErrore() {
        return $this->messaggioErrore;
    }

    public function setMessaggioErrore($msg) {
        $this->messaggioErrore = $msg;
    }

    public function getSottoPagina() {
        return $this->sottoPagina;
    }

    public function setSottoPagina($pag) {
        $this->sottoPagina = $pag;
    }

    public function getMessaggioConferma() {
        return $this->messaggioConferma;
    }

    public function setMessaggioConferma($msg) {
        $this->messaggioConferma = $msg;
    }

    public function getPagina() {
        return $this->pagina;
    }

    public function setPagina($pagina) {
        $this->pagina = $pagina;
    }

    public function addScript($nome){
        $this->js[] = $nome;
    }
    
    public function &getScripts(){
        return $this->js;
    }
    
    /**
     * True se si devono scrivere dati json, false altrimenti
     * @return Boolean
     */
    public function isJson(){
        return $this->json;
    }
    
    /**
     * Da chiamare se la risposta contiene dati json
     */
    public function toggleJson(){
        $this->json = true;
    }
    

    
    /**
     * Restituisce il valore corrente del token per fare in modo che
     * un amministratore possa impersonare uno studente o un docente
     * @param string $token
     */
    public function setImpToken($token) {
        $this->impToken = $token;
    }

    /**
     * Scrive un token per gestire quale sia l'utente che l'amministratore
     * sta impersonando per svolgere delle operazioni in sua vece. 
     * 
     * Questo metodo concentra in un solo punto il mantenimento di questa
     * informazione, che deve essere appesa per ogni get e per ogni post
     * quando si accede all'interfaccia dello studente o del docente 
     * in modalita' amministratore, in modo che possano essere impersonati 
     * piu' utenti tramite diversi schede dello stesso browser
     * 
     * Se avessimo inserito questa informazione in sessione, sarebbe stato 
     * possibile gestirne solo uno. Inoltre, in caso di piu' schede aperte con 
     * lo stesso browser, i dati sarebbero stati mescolati.
     * 
     * Questo e' un esempio di gestione di variabili a livello pagina. 
     * 
     * @param string $pre il prefisso per attaccare il parametro del token nella 
     * query string. Si usi '?' se il token e' il primo parametro e '&' altrimenti
     * @param int $method metodo HTTP (get o set)
     * @return string il valore da scrivere nella URL in caso di get o come
     * hidden input in caso di form
     */
    public function scriviToken($pre = '', $method = self::get) {
        $imp = BaseController::impersonato;
        switch ($method) {
            case self::get:
                if (isset($this->impToken)) {
                    // nel caso della 
                    return $pre . "$imp=$this->impToken";
                }
                break;

            case self::post:
                if (isset($this->impToken)) {
                    return "<input type=\"hidden\" name=\"$imp\" value=\"$this->impToken\"/>";
                }
                break;
        }

        return '';
    }

}

?>
